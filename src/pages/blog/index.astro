---
import { getCollection } from 'astro:content';
import Base from '../../layouts/Base.astro';
import '../../styles/blog.css';

const posts = await getCollection('blog', ({ data }) => !data.draft);
const sortedPosts = posts.sort(
  (a, b) => new Date(b.data.publishedDate).valueOf() - new Date(a.data.publishedDate).valueOf()
);

const title = "Blog | SPUN Factura - Gu√≠as de Facturaci√≥n para Construcci√≥n";
const description = "Gu√≠as pr√°cticas sobre facturaci√≥n, Verifactu, IVA y gesti√≥n fiscal para profesionales de construcci√≥n y reformas.";
---

<Base title={title} description={description}>
  <div class="blog-index">
    <!-- Header -->
    <header class="blog-header">
      <h1>Blog SPUN Factura</h1>
      <p>Gu√≠as pr√°cticas sobre facturaci√≥n, Verifactu, IVA y gesti√≥n fiscal para profesionales de construcci√≥n y reformas.</p>
    </header>

    <!-- Posts Grid -->
    <div class="posts-grid">
      {sortedPosts.map((post) => (
        <a href={`/blog/${post.slug}`} class="post-card">
          {post.data.image ? (
            <img 
              src={post.data.image} 
              alt={post.data.imageAlt || post.data.title}
              class="post-card-image"
              loading="lazy"
            />
          ) : (
            <div class="post-card-image-placeholder">
              üìÑ
            </div>
          )}
          <div class="post-card-content">
            {post.data.category && (
              <span class="post-card-category">{post.data.category}</span>
            )}
            <h2>{post.data.title}</h2>
            <p>{post.data.description}</p>
            <div class="post-card-meta">
              <span>{new Date(post.data.publishedDate).toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
              })}</span>
              {post.data.readingTime && <span>‚Ä¢ {post.data.readingTime} min</span>}
            </div>
          </div>
        </a>
      ))}
    </div>

    <!-- CTA Section -->
    <section class="blog-cta">
      <h3>¬øQuieres estar preparado para Verifactu?</h3>
      <p>Reg√≠strate y te avisamos cuando SPUN Factura est√© disponible.</p>
      <a href="/#reservar" class="btn-primary">Reservar mi plaza ‚Üí</a>
    </section>
  </div>
</Base>
