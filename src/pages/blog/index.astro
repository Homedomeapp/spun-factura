---
import Base from '../../layouts/Base.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog', ({ data }) => !data.draft))
  .sort((a, b) => new Date(b.data.publishedDate).valueOf() - new Date(a.data.publishedDate).valueOf());
---

<Base 
  title="Blog | SPUN Factura - Guías de Facturación para Construcción"
  description="Guías prácticas sobre facturación, Verifactu, IVA en reformas y gestión fiscal para profesionales de construcción y reformas en España."
>
  <div class="blog-page">
    <div class="container">
      <header class="blog-header">
        <h1>Blog SPUN Factura</h1>
        <p class="blog-subtitle">
          Guías prácticas sobre facturación, Verifactu, IVA y gestión fiscal para profesionales de construcción y reformas.
        </p>
      </header>

      {posts.length === 0 ? (
        <div class="no-posts">
          <p>Estamos preparando contenido útil para ti. ¡Vuelve pronto!</p>
          <a href="/" class="btn-primary">Volver al inicio</a>
        </div>
      ) : (
        <div class="posts-grid">
          {posts.map((post, index) => (
            <article class={`post-card ${index === 0 ? 'featured' : ''}`}>
              <a href={`/blog/${post.slug}`}>
                {post.data.category && (
                  <span class="post-category">{post.data.category}</span>
                )}
                <h2>{post.data.title}</h2>
                <p>{post.data.description}</p>
                <div class="post-meta">
                  <time datetime={post.data.publishedDate}>
                    {new Date(post.data.publishedDate).toLocaleDateString('es-ES', { 
                      year: 'numeric', 
                      month: 'long', 
                      day: 'numeric' 
                    })}
                  </time>
                  {post.data.readingTime && (
                    <span class="reading-time">{post.data.readingTime} min</span>
                  )}
                </div>
              </a>
            </article>
          ))}
        </div>
      )}

      <div class="blog-cta">
        <h3>¿Quieres estar preparado para Verifactu?</h3>
        <p>Regístrate y te avisamos cuando SPUN Factura esté disponible.</p>
        <a href="/#reservar" class="btn-primary">Reservar mi plaza</a>
      </div>
    </div>
  </div>
</Base>

<style>
  .blog-page { padding: 120px 0 80px; }
  .blog-header { text-align: center; margin-bottom: 48px; }
  .blog-header h1 { margin-bottom: 16px; }
  .blog-subtitle { font-size: 1.125rem; color: var(--color-text-muted); max-width: 600px; margin: 0 auto; }
  
  .no-posts { text-align: center; padding: 60px 0; }
  .no-posts p { font-size: 1.125rem; margin-bottom: 24px; color: var(--color-text-muted); }
  
  .posts-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; margin-bottom: 60px; }
  
  .post-card { border: 1px solid var(--color-border); border-radius: 12px; overflow: hidden; transition: all 0.3s; }
  .post-card:hover { border-color: var(--color-primary); transform: translateY(-4px); box-shadow: 0 8px 24px rgba(0,0,0,0.1); }
  .post-card a { display: block; padding: 28px; text-decoration: none; color: inherit; }
  .post-card.featured { grid-column: span 2; background: var(--color-bg-section); border-color: var(--color-primary-light); }
  .post-card.featured h2 { font-size: 1.5rem; }
  
  .post-category { display: inline-block; background: white; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 500; color: var(--color-primary-dark); margin-bottom: 12px; }
  .post-card h2 { font-size: 1.125rem; margin-bottom: 8px; line-height: 1.3; }
  .post-card p { font-size: 0.9375rem; color: var(--color-text-muted); margin-bottom: 16px; line-height: 1.5; }
  .post-meta { display: flex; gap: 16px; font-size: 0.8125rem; color: var(--color-text-muted); }
  .reading-time::before { content: '•'; margin-right: 16px; }
  
  .blog-cta { text-align: center; background: var(--color-bg-alt); border-radius: 12px; padding: 48px 32px; }
  .blog-cta h3 { margin-bottom: 8px; }
  .blog-cta p { margin-bottom: 24px; color: var(--color-text-muted); }
  
  @media (max-width: 768px) {
    .posts-grid { grid-template-columns: 1fr; }
    .post-card.featured { grid-column: span 1; }
  }
</style>
