---
import Base from './Base.astro';

interface Props {
  title: string;
  description: string;
  publishedDate: string;
  updatedDate?: string;
  category?: string;
  tags?: string[];
  readingTime?: number;
}

const { title, description, publishedDate, updatedDate, category, tags = [], readingTime } = Astro.props;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);

const articleSchema = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": title,
  "description": description,
  "datePublished": publishedDate,
  "dateModified": updatedDate || publishedDate,
  "author": { "@type": "Organization", "name": "SPUN", "url": "https://spun.es" },
  "publisher": { "@type": "Organization", "name": "SPUN", "logo": { "@type": "ImageObject", "url": "https://factura.spun.es/images/SPUN-LOGO-SPUN-LOGO_Monogram-Blue.png" } },
  "mainEntityOfPage": { "@type": "WebPage", "@id": canonicalURL.toString() }
};
---

<Base title={`${title} | SPUN Factura`} description={description}>
  <script type="application/ld+json" set:html={JSON.stringify(articleSchema)} />
  
  <article class="blog-post">
    <div class="container-narrow">
      <header class="post-header">
        <div class="post-meta">
          {category && <span class="post-category">{category}</span>}
          <time datetime={publishedDate}>
            {new Date(publishedDate).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}
          </time>
          {readingTime && <span class="reading-time">{readingTime} min de lectura</span>}
        </div>
        <h1>{title}</h1>
        <p class="post-description">{description}</p>
        {tags.length > 0 && (
          <div class="post-tags">
            {tags.map(tag => <span class="tag">#{tag}</span>)}
          </div>
        )}
      </header>

      <div class="post-content">
        <slot />
      </div>

      <footer class="post-footer">
        {updatedDate && (
          <p class="last-updated">
            Última actualización: {new Date(updatedDate).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}
          </p>
        )}
        <div class="post-cta">
          <h3>¿Quieres estar preparado para Verifactu?</h3>
          <p>SPUN Factura está diseñado para profesionales de construcción. Regístrate y te avisamos del lanzamiento.</p>
          <a href="/#reservar" class="btn-primary">Reservar mi plaza</a>
        </div>
        <a href="/blog" class="back-to-blog">← Volver al blog</a>
      </footer>
    </div>
  </article>
</Base>

<style>
  .blog-post { padding: 120px 0 80px; }
  .post-header { margin-bottom: 48px; padding-bottom: 32px; border-bottom: 1px solid var(--color-border); }
  .post-meta { display: flex; flex-wrap: wrap; gap: 16px; align-items: center; font-size: 0.875rem; color: var(--color-text-muted); margin-bottom: 16px; }
  .post-category { background: var(--color-bg-section); color: var(--color-primary-dark); padding: 4px 12px; border-radius: 20px; font-weight: 500; }
  .reading-time::before { content: '•'; margin-right: 16px; }
  .post-header h1 { font-size: 2.25rem; margin-bottom: 16px; line-height: 1.2; }
  .post-description { font-size: 1.125rem; color: var(--color-text-muted); margin-bottom: 16px; }
  .post-tags { display: flex; flex-wrap: wrap; gap: 8px; }
  .tag { font-size: 0.8125rem; color: var(--color-text-muted); }
  
  .post-content { font-size: 1.0625rem; line-height: 1.8; }
  .post-content :global(h2) { margin-top: 48px; margin-bottom: 16px; font-size: 1.5rem; padding-bottom: 8px; border-bottom: 2px solid var(--color-primary-light); }
  .post-content :global(h3) { margin-top: 32px; margin-bottom: 12px; font-size: 1.25rem; }
  .post-content :global(p) { margin-bottom: 20px; color: var(--color-text); }
  .post-content :global(ul), .post-content :global(ol) { margin: 20px 0; padding-left: 24px; }
  .post-content :global(li) { margin-bottom: 8px; }
  .post-content :global(blockquote) { border-left: 4px solid var(--color-primary); padding-left: 20px; margin: 24px 0; font-style: italic; color: var(--color-text-muted); }
  .post-content :global(table) { width: 100%; border-collapse: collapse; margin: 24px 0; }
  .post-content :global(th), .post-content :global(td) { padding: 12px 16px; text-align: left; border-bottom: 1px solid var(--color-border); }
  .post-content :global(th) { background: var(--color-bg-alt); font-weight: 600; }
  .post-content :global(code) { background: var(--color-bg-alt); padding: 2px 6px; border-radius: 4px; font-size: 0.9em; }
  .post-content :global(a) { color: var(--color-primary-dark); }
  
  .post-footer { margin-top: 48px; padding-top: 32px; border-top: 1px solid var(--color-border); }
  .last-updated { font-size: 0.875rem; color: var(--color-text-muted); margin-bottom: 32px; }
  .post-cta { background: var(--color-bg-section); border: 1px solid var(--color-primary-light); border-radius: 12px; padding: 32px; text-align: center; margin-bottom: 32px; }
  .post-cta h3 { margin-bottom: 8px; color: var(--color-text); }
  .post-cta p { margin-bottom: 20px; color: var(--color-text-muted); }
  .back-to-blog { display: inline-block; color: var(--color-primary-dark); font-weight: 500; text-decoration: none; }
  .back-to-blog:hover { text-decoration: underline; }
  
  @media (max-width: 768px) {
    .post-header h1 { font-size: 1.75rem; }
  }
</style>
